{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "NutriCoach Feature Template",
  "description": "Template de validation pour les sp√©cifications de features NutriCoach",
  "type": "object",
  "required": ["project", "version", "features"],
  "properties": {
    "project": {
      "type": "string",
      "enum": ["NutriCoach"]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "features": {
      "type": "object",
      "patternProperties": {
        "^[a-z][a-z0-9-]*$": {
          "$ref": "#/definitions/Feature"
        }
      },
      "additionalProperties": false
    }
  },
  "definitions": {
    "Feature": {
      "type": "object",
      "required": ["feature", "agents"],
      "properties": {
        "feature": {
          "$ref": "#/definitions/FeatureInfo"
        },
        "agents": {
          "$ref": "#/definitions/AgentsConfig"
        },
        "validation": {
          "$ref": "#/definitions/ValidationConfig"
        },
        "deployment": {
          "$ref": "#/definitions/DeploymentConfig"
        }
      },
      "additionalProperties": false
    },
    "FeatureInfo": {
      "type": "object",
      "required": ["name", "description", "type", "estimatedTime"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 3
        },
        "description": {
          "type": "string",
          "minLength": 10
        },
        "type": {
          "type": "string",
          "enum": [
            "crud-feature",
            "ai-feature", 
            "ui-enhancement",
            "api-integration",
            "performance-optimization",
            "security-feature",
            "analytics-feature"
          ]
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "default": "medium"
        },
        "estimatedTime": {
          "type": "string",
          "pattern": "^\\d+[hd]$"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "AgentsConfig": {
      "type": "object",
      "properties": {
        "db-agent": { "$ref": "#/definitions/AgentConfig" },
        "ui-agent": { "$ref": "#/definitions/AgentConfig" },
        "module-agent": { "$ref": "#/definitions/AgentConfig" },
        "qa-agent": { "$ref": "#/definitions/AgentConfig" },
        "doc-agent": { "$ref": "#/definitions/AgentConfig" }
      },
      "additionalProperties": false
    },
    "AgentConfig": {
      "type": "object",
      "required": ["required"],
      "properties": {
        "required": {
          "type": "boolean"
        },
        "tasks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Task"
          },
          "minItems": 1
        }
      },
      "additionalProperties": false
    },
    "Task": {
      "type": "object",
      "required": ["id", "type", "description", "priority", "estimatedTime"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "type": {
          "type": "string",
          "enum": [
            "schema", "migration", "rls-policy", "index", "function",
            "component", "page", "layout", "design-system", "responsive",
            "api-endpoint", "business-logic", "ai-integration", "external-api", "validation", "middleware", "service",
            "unit-tests", "integration-tests", "e2e-tests", "performance-tests", "security-tests", "accessibility-tests",
            "api-docs", "user-guide", "tutorial", "technical-doc", "troubleshooting", "changelog"
          ]
        },
        "description": {
          "type": "string",
          "minLength": 5
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "estimatedTime": {
          "type": "string",
          "pattern": "^\\d+[hm]$"
        },
        "useContext7": {
          "type": "boolean",
          "default": true
        },
        "dependsOn": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "spec": {
          "type": "object"
        }
      },
      "additionalProperties": false
    },
    "ValidationConfig": {
      "type": "object",
      "properties": {
        "crossAgentChecks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/CrossAgentCheck"
          }
        },
        "integrationTests": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "qualityGates": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/QualityGate"
          }
        }
      },
      "additionalProperties": false
    },
    "CrossAgentCheck": {
      "type": "object",
      "required": ["name", "type", "agents", "rules"],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["data-consistency", "api-contract", "type-safety", "security"]
        },
        "agents": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["db-agent", "ui-agent", "module-agent", "qa-agent", "doc-agent"]
          },
          "minItems": 2
        },
        "rules": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        }
      },
      "additionalProperties": false
    },
    "QualityGate": {
      "type": "object",
      "required": ["name", "type", "threshold"],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["coverage", "performance", "security", "accessibility", "complexity"]
        },
        "threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "blocking": {
          "type": "boolean",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "DeploymentConfig": {
      "type": "object",
      "properties": {
        "environment": {
          "type": "string",
          "enum": ["development", "staging", "production"]
        },
        "rollback": {
          "type": "boolean",
          "default": true
        },
        "monitoring": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    }
  }
}